name: Keep Railway Server Alive

on:
  schedule:
    # ë§¤ 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (Railway ë¬´ë£Œ í”Œëœ sleep ë°©ì§€)
    - cron: '*/10 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping-server:
    runs-on: ubuntu-latest
    
    steps:
    - name: Keep Railway Server Alive
      run: |
        echo "ğŸ“ Pinging Railway server to prevent sleep..."
        
        # Railway ì„œë²„ URL (ì‹¤ì œ URLë¡œ ë³€ê²½ í•„ìš”)
        SERVER_URL="${{ secrets.RAILWAY_SERVER_URL || 'https://your-app.railway.app' }}"
        
        # ping ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
        response=$(curl -s -w "HTTPSTATUS:%{http_code}" "$SERVER_URL/api/ping")
        http_code=$(echo $response | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… Server is alive! HTTP $http_code"
          echo "Response: $(echo $response | sed -e 's/HTTPSTATUS:.*//g')"
        else
          echo "âŒ Server might be down. HTTP $http_code"
          echo "Response: $(echo $response | sed -e 's/HTTPSTATUS:.*//g')"
          exit 1
        fi
        
        # heartbeat ì—”ë“œí¬ì¸íŠ¸ë„ í˜¸ì¶œ
        echo "ğŸ«€ Checking heartbeat..."
        heartbeat_response=$(curl -s -w "HTTPSTATUS:%{http_code}" "$SERVER_URL/api/heartbeat")
        heartbeat_code=$(echo $heartbeat_response | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
        
        if [ "$heartbeat_code" -eq 200 ]; then
          echo "âœ… Heartbeat OK! HTTP $heartbeat_code"
        else
          echo "âš ï¸  Heartbeat check failed. HTTP $heartbeat_code"
        fi
        
        echo "ğŸ¯ Keep-alive ping completed at $(date)"