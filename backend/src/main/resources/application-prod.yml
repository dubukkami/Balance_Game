# ===============================
# 🍻 술하재밸 - 운영 환경 (Railway + Neon DB)
# ===============================

# PostgreSQL 데이터베이스 설정 (Neon DB)
DATABASE_URL: ${DATABASE_URL}  # Railway에서 자동 설정
DB_DRIVER: org.postgresql.Driver
DB_USERNAME: ${DB_USERNAME}
DB_PASSWORD: ${DB_PASSWORD}

# H2 콘솔 비활성화 (보안)
H2_CONSOLE_ENABLED: false

# JPA 설정 (운영용)
DDL_AUTO: update  # 운영에서는 스키마 보존
SHOW_SQL: false   # 성능상 SQL 로깅 비활성화
FORMAT_SQL: false
HIBERNATE_DIALECT: org.hibernate.dialect.PostgreSQLDialect
DATABASE_TYPE: postgresql

# CORS 설정 (운영 도메인)
CORS_ORIGINS: ${FRONTEND_URL}  # Vercel 배포 URL

# OAuth2 리다이렉트 URI (운영)
GOOGLE_REDIRECT_URI: ${BACKEND_URL}/login/oauth2/code/google
KAKAO_REDIRECT_URI: ${BACKEND_URL}/login/oauth2/code/kakao
NAVER_REDIRECT_URI: ${BACKEND_URL}/login/oauth2/code/naver
AUTHORIZED_REDIRECT_URI: ${AUTHORIZED_REDIRECT_URI}  # 프론트엔드 리다이렉트 URL

# 서버 설정 (Railway 자동 포트)
SERVER_PORT: ${PORT:8080}

# JWT 설정 (운영용 - 긴 만료시간)
JWT_SECRET: ${JWT_SECRET}  # 강력한 시크릿 키 필수
JWT_TOKEN_VALIDITY: ${JWT_TOKEN_VALIDITY:604800}  # 7일

# 로깅 설정 (운영용 - 최소 로깅)
LOG_LEVEL_ROOT: WARN
LOG_LEVEL_APP: INFO
LOG_LEVEL_WEB: WARN
LOG_LEVEL_SQL: WARN
LOG_LEVEL_SQL_PARAMS: WARN

# 운영 환경 전용 설정
spring:
  # 데이터베이스 커넥션 풀 최적화 (무료 플랜 고려)
  datasource:
    hikari:
      maximum-pool-size: ${DB_MAX_POOL_SIZE:5}
      minimum-idle: ${DB_MIN_IDLE:1}
      idle-timeout: ${DB_IDLE_TIMEOUT:300000}      # 5분
      max-lifetime: ${DB_MAX_LIFETIME:1200000}     # 20분
      connection-timeout: ${DB_CONNECTION_TIMEOUT:20000}  # 20초
      leak-detection-threshold: ${DB_LEAK_DETECTION:60000}  # 1분

  # 에러 처리 (운영용)
  web:
    resources:
      add-mappings: false  # 정적 리소스 비활성화
  
  # Jackson 직렬화 최적화
  jackson:
    default-property-inclusion: NON_NULL
    serialization:
      write-dates-as-timestamps: false

# 서버 최적화 설정 (Railway 무료 플랜 대응)
server:
  # Tomcat 커넥션 최적화
  tomcat:
    max-connections: ${SERVER_MAX_CONNECTIONS:50}
    accept-count: ${SERVER_ACCEPT_COUNT:10}
    max-threads: ${SERVER_MAX_THREADS:20}
    min-spare-threads: ${SERVER_MIN_THREADS:2}
    connection-timeout: ${SERVER_CONNECTION_TIMEOUT:20000}
    
  # 응답 압축 (트래픽 절약)
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml
    min-response-size: 1024
    
  # 에러 페이지 비활성화 (보안)
  error:
    whitelabel:
      enabled: false
    include-stacktrace: never
    include-message: never

# 헬스체크 및 모니터링 (Railway 대응)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      cache:
        time-to-live: ${HEALTH_CACHE_TTL:5s}
    info:
      enabled: true
  health:
    diskspace:
      threshold: ${HEALTH_DISK_THRESHOLD:100MB}
    db:
      enabled: true

# 앱 메타데이터
app:
  name: 술하재밸
  version: ${APP_VERSION:1.0.0}
  environment: production
  
# 보안 설정
security:
  require-ssl: ${REQUIRE_SSL:false}  # Railway는 자동 HTTPS 제공