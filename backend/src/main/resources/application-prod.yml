# ===============================
# ğŸ» ìˆ í•˜ì¬ë°¸ - ìš´ì˜ í™˜ê²½ (Railway + Neon DB)
# ===============================

spring:
  # ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•œ ìë™ ì„¤ì • ì œì™¸
  autoconfigure:
    exclude:
      - org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration
      - org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration
      - org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration
      - org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration

  # PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (Neon DB)
  datasource:
    url: ${DATABASE_URL}  # Railwayì—ì„œ ìë™ ì„¤ì •
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    
    # Railway 512MB ë©”ëª¨ë¦¬ ì œí•œ ê·¹í•œ ìµœì í™”
    hikari:
      maximum-pool-size: 1        # ê·¹í•œ ë©”ëª¨ë¦¬ ì ˆì•½ - ë‹¨ì¼ ì»¤ë„¥ì…˜
      minimum-idle: 1             
      idle-timeout: 60000         # 1ë¶„ìœ¼ë¡œ ë‹¨ì¶•
      max-lifetime: 300000        # 5ë¶„ìœ¼ë¡œ ë‹¨ì¶•  
      connection-timeout: 5000    # 5ì´ˆ
      leak-detection-threshold: 0 # ë¹„í™œì„±í™”
      validation-timeout: 2000    # 2ì´ˆ

  # H2 ì½˜ì†” ë¹„í™œì„±í™” (ë³´ì•ˆ)
  h2:
    console:
      enabled: false

  # JPA ì„¤ì • (ìš´ì˜ìš©)
  jpa:
    hibernate:
      ddl-auto: create
    show-sql: false
    properties:
      hibernate:
        default_schema: public
        jdbc:
          batch_size: 5               # ë°°ì¹˜ í¬ê¸° ê°ì†Œ
          order_inserts: true
          order_updates: true
          batch_versioned_data: true
        format_sql: false
        use_sql_comments: false
        temp:
          use_jdbc_metadata_defaults: false
        cache:
          use_second_level_cache: false
          use_query_cache: false
          use_structured_cache: false
        connection:
          provider_disables_autocommit: false
        # ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•œ ì¶”ê°€ ì„¤ì •
        order_by:
          default_null_ordering: none
        sql:
          init_command: "SET sql_mode=''"
    database: postgresql
    open-in-view: false

  # CORS ì„¤ì • (ìš´ì˜ ë„ë©”ì¸)
  web:
    cors:
      allowed-origins: ${FRONTEND_URL}  # Vercel ë°°í¬ URL
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        - PATCH
      allowed-headers: "*"
      allow-credentials: true
    resources:
      add-mappings: false  # ì •ì  ë¦¬ì†ŒìŠ¤ ë¹„í™œì„±í™”

  # OAuth2 ì„¤ì • (ìš´ì˜)
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            redirect-uri: ${BACKEND_URL}/login/oauth2/code/google
            scope:
              - email
              - profile
          kakao:
            client-id: ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            redirect-uri: ${BACKEND_URL}/login/oauth2/code/kakao
            authorization-grant-type: authorization_code
            scope:
              - profile_nickname
              - account_email
              - profile_image
            client-name: Kakao
          naver:
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            redirect-uri: ${BACKEND_URL}/login/oauth2/code/naver
            authorization-grant-type: authorization_code
            scope:
              - name
              - email
              - profile_image
            client-name: Naver
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response

  # Jackson ì§ë ¬í™” ìµœì í™”
  jackson:
    default-property-inclusion: NON_NULL
    serialization:
      write-dates-as-timestamps: false

# ì„œë²„ ìµœì í™” ì„¤ì • (Railway ë¬´ë£Œ í”Œëœ ëŒ€ì‘)
server:
  port: ${PORT:8080}  # Railway ìë™ í¬íŠ¸
  
  # Railway 512MB ë©”ëª¨ë¦¬ ì œí•œ ê·¹í•œ ìµœì í™”
  tomcat:
    max-connections: 10           # ìµœì†Œí•œìœ¼ë¡œ ê°ì†Œ
    accept-count: 2               # ëŒ€ê¸°ì—´ ìµœì†Œí™”
    max-threads: 4                # ìŠ¤ë ˆë“œ ìˆ˜ ëŒ€í­ ê°ì†Œ
    min-spare-threads: 1          # ìµœì†Œ ìŠ¤ë ˆë“œ
    connection-timeout: 8000
    # ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•œ ì¶”ê°€ ì„¤ì •
    max-swallow-size: 1MB         # ìŠ¤ì™ˆë¡œìš° í¬ê¸° ì œí•œ
    max-http-form-post-size: 1MB  # í¬ìŠ¤íŠ¸ í¬ê¸° ì œí•œ
  servlet:
    multipart:
      max-file-size: 1MB          # íŒŒì¼ í¬ê¸° ì œí•œ
      max-request-size: 2MB       # ìš”ì²­ í¬ê¸° ì œí•œ
    # ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•œ ì¶”ê°€ ì„¤ì •
    session:
      timeout: 10m                # ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë‹¨ì¶•
    encoding:
      charset: UTF-8
      enabled: true
    
  compression:
    enabled: true
    mime-types: application/json,text/html,text/css,text/javascript
    min-response-size: 512
    
  # ì—ëŸ¬ í˜ì´ì§€ ë¹„í™œì„±í™” (ë³´ì•ˆ)
  error:
    whitelabel:
      enabled: false
    include-stacktrace: never
    include-message: never

# JWT ì„¤ì • (ìš´ì˜ìš©)
jwt:
  secret: ${JWT_SECRET}  # ê°•ë ¥í•œ ì‹œí¬ë¦¿ í‚¤ í•„ìˆ˜
  token-validity-in-seconds: ${JWT_TOKEN_VALIDITY:604800}  # 7ì¼

# ì•± ì„¤ì •
app:
  name: ìˆ í•˜ì¬ë°¸
  version: ${APP_VERSION:1.0.0}
  environment: production
  oauth2:
    authorized-redirect-uri: ${AUTHORIZED_REDIRECT_URI}  # í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL

# í—¬ìŠ¤ì²´í¬ ë° ëª¨ë‹ˆí„°ë§ (Railway ë¬´ë£Œí”Œëœ ëŒ€ì‘)
management:
  endpoints:
    web:
      exposure:
        include: health
      base-path: /actuator
  endpoint:
    health:
      show-details: never  # ë³´ì•ˆìƒ ì„¸ë¶€ì‚¬í•­ ìˆ¨ê¹€
      cache:
        time-to-live: 10s  # ìºì‹œ ì‹œê°„ ëŠ˜ë ¤ì„œ ë¶€í•˜ ê°ì†Œ
  health:
    diskspace:
      enabled: false  # Railwayì—ì„œ ë¶ˆí•„ìš”
    db:
      enabled: true
  metrics:
    enable:
      all: false  # ëª¨ë“  ë©”íŠ¸ë¦­ìŠ¤ ë¹„í™œì„±í™”ë¡œ ë©”ëª¨ë¦¬ ì ˆì•½

# ë¡œê¹… ì„¤ì • (ë©”ëª¨ë¦¬ ì ˆì•½ - Railway 512MB ì œí•œ)
logging:
  level:
    root: WARN                    # ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•´ ë¡œê·¸ ë ˆë²¨ ìƒìŠ¹
    com.drink.balancegame: INFO
    org.springframework: ERROR    # Spring ë¡œê·¸ ìµœì†Œí™”
    org.hibernate: ERROR          # Hibernate ë¡œê·¸ ìµœì†Œí™”
    com.zaxxer.hikari: ERROR      # HikariCP ë¡œê·¸ ìµœì†Œí™”
  pattern:
    console: "%d{HH:mm:ss} %-5level %logger{20} - %msg%n"  # ê°„ì†Œí™”ëœ ë¡œê·¸ íŒ¨í„´

# ë³´ì•ˆ ì„¤ì •
security:
  require-ssl: ${REQUIRE_SSL:false}  # RailwayëŠ” ìë™ HTTPS ì œê³µ